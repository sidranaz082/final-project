<!-- templates/index.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>AI Resume & Cover Letter Generator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container py-5">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="card-title text-center mb-4">AI Resume & Cover Letter Generator</h2>

        <form id="genForm">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Full name</label>
              <input name="name" id="name" class="form-control" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Current title</label>
              <input name="title" id="title" class="form-control" required>
            </div>

            <div class="col-md-6">
              <label class="form-label">Contact (email/phone)</label>
              <input name="contact" id="contact" class="form-control">
            </div>

            <div class="col-md-6">
              <label class="form-label">Company (for cover letter)</label>
              <input name="company" id="company" class="form-control">
            </div>

            <div class="col-12">
              <label class="form-label">Skills (comma separated)</label>
              <input name="skills" id="skills" class="form-control">
            </div>

            <div class="col-12">
              <label class="form-label">Work experience (brief)</label>
              <textarea name="experience" id="experience" rows="4" class="form-control"></textarea>
            </div>

            <div class="col-12">
              <label class="form-label">Achievements (optional)</label>
              <textarea name="achievements" id="achievements" rows="2" class="form-control"></textarea>
            </div>

            <div class="col-md-4">
              <label class="form-label">Document type</label>
              <select id="type" class="form-select">
                <option value="resume">Resume</option>
                <option value="cover">Cover Letter</option>
                <option value="both">Both</option>
              </select>
            </div>

            <div class="col-md-4">
              <label class="form-label">Max tokens</label>
              <input id="max_tokens" class="form-control" type="number" value="200">
            </div>

            <div class="col-md-4">
              <label class="form-label">Temperature</label>
              <input id="temperature" class="form-control" type="number" step="0.1" min="0" max="1" value="0.7">
            </div>
          </div>

          <div class="d-flex gap-2 mt-4">
            <button id="generateBtn" class="btn btn-primary">Generate</button>
            <button id="downloadBtn" type="button" class="btn btn-outline-success">Download PDF</button>
            <div id="spinner" class="spinner-border text-primary ms-auto" role="status" style="display:none"></div>
          </div>
        </form>

        <hr class="my-4">

        <div id="resultArea">
          <h5>Result</h5>
          <pre id="resultContent" class="p-3 bg-light rounded" style="white-space:pre-wrap;"></pre>
        </div>

      </div>
    </div>
  </div>

<script>
const form = document.getElementById('genForm');
const genBtn = document.getElementById('generateBtn');
const spinner = document.getElementById('spinner');
const resultContent = document.getElementById('resultContent');
const downloadBtn = document.getElementById('downloadBtn');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  spinner.style.display = 'inline-block';
  resultContent.textContent = '';
  const payload = {
    name: document.getElementById('name').value,
    title: document.getElementById('title').value,
    contact: document.getElementById('contact').value,
    company: document.getElementById('company').value,
    skills: document.getElementById('skills').value,
    experience: document.getElementById('experience').value,
    achievements: document.getElementById('achievements').value,
    type: document.getElementById('type').value,
    max_tokens: document.getElementById('max_tokens').value,
    temperature: document.getElementById('temperature').value
  };

  try {
    const res = await fetch('/generate', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if (!data.success) {
      resultContent.textContent = 'Error: ' + (data.error || 'Unknown');
    } else {
      // build readable output
      let out = '';
      if (data.result.resume) {
        out += '--- RESUME ---\n';
        out += data.result.resume.success ? data.result.resume.text : 'Error: ' + data.result.resume.error;
        out += '\n\n';
      }
      if (data.result.cover_letter) {
        out += '--- COVER LETTER ---\n';
        out += data.result.cover_letter.success ? data.result.cover_letter.text : 'Error: ' + data.result.cover_letter.error;
        out += '\n\n';
      }
      resultContent.textContent = out.trim();
    }
  } catch (err) {
    resultContent.textContent = 'Request failed: ' + err.message;
  } finally {
    spinner.style.display = 'none';
  }
});

downloadBtn.addEventListener('click', async () => {
  // same payload, request PDF
  const payload = {
    name: document.getElementById('name').value,
    title: document.getElementById('title').value,
    contact: document.getElementById('contact').value,
    company: document.getElementById('company').value,
    skills: document.getElementById('skills').value,
    experience: document.getElementById('experience').value,
    achievements: document.getElementById('achievements').value,
    type: document.getElementById('type').value,
    max_tokens: document.getElementById('max_tokens').value,
    temperature: document.getElementById('temperature').value
  };

  spinner.style.display = 'inline-block';
  try {
    const res = await fetch('/download_pdf', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    if (!res.ok) {
      const t = await res.text();
      resultContent.textContent = 'PDF generation failed: ' + t;
      return;
    }
    const blob = await res.blob();
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = (document.getElementById('name').value || 'documents') + '_documents.pdf';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  } catch (err) {
    resultContent.textContent = 'PDF download failed: ' + err.message;
  } finally {
    spinner.style.display = 'none';
  }
});
</script>
</body>
</html>
